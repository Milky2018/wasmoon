{"id":"wasmoon-1cg","title":"Reduce call arg moves","description":"Reduce call-argument move traffic in lowering/peephole to shrink call sequences.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T19:33:28.706462+08:00","created_by":"Milky2018","updated_at":"2026-01-20T20:32:34.837844+08:00","closed_at":"2026-01-20T20:32:34.837844+08:00","close_reason":"Closed","labels":["jit","perf"]}
{"id":"wasmoon-1h7","title":"JIT hang regressions in spec WASTs","description":"JIT hangs on spec/align.wast, spec/block.wast, spec/br_on_non_null.wast after recent optimizations. Reproduce in testsuite and prevent regressions via moon test.","notes":"Removed unsafe VCode coalesce pass causing JIT hangs; added JIT WAST regression tests; tightened swap-aware regalloc rewrite. Tests: moon test -p Milky2018/wasmoon/testsuite -f wast_hang_regression_test.mbt; moon test -p Milky2018/wasmoon/vcode/lower -f lower_wbtest.mbt; moon test -p Milky2018/wasmoon/vcode/regalloc -f regalloc_wbtest.mbt.","status":"closed","priority":0,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T11:36:42.659409+08:00","created_by":"Milky2018","updated_at":"2026-01-21T12:41:16.179485+08:00","closed_at":"2026-01-21T12:41:16.179487+08:00","comments":[{"id":3,"issue_id":"wasmoon-1h7","author":"Milky2018","text":"Added testsuite regression coverage in testsuite/wast_hang_regression_test.mbt to run spec/align.wast, spec/block.wast, spec/br_on_non_null.wast under JIT via WAST runner.","created_at":"2026-01-21T03:49:33Z"}]}
{"id":"wasmoon-1vb","title":"Eliminate trivial post-regalloc moves","description":"Remove redundant Move instructions when src/dst are same physical register (including float/vector aliasing), after allocation.","notes":"Added post-regalloc pass to drop redundant Move instructions with same physical reg (float/vector alias aware). Tests: moon test -p Milky2018/wasmoon/vcode/regalloc -f regalloc_wbtest.mbt.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T13:18:50.538336+08:00","created_by":"Milky2018","updated_at":"2026-01-21T13:19:47.624511+08:00","closed_at":"2026-01-21T13:19:47.624513+08:00"}
{"id":"wasmoon-1xg","title":"WASI JIT resolve_path allows path traversal outside preopens","description":"resolve_path() in jit/jit_ffi/wasi.c concatenates host preopen + guest path without canonicalization or absolute-path rejection. This allows '..' traversal to escape sandbox. Fix by rejecting absolute paths and normalizing (or using openat-based resolution) consistent with interpreter semantics.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:47:12.457222+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:06:25.94389+08:00","closed_at":"2026-01-21T14:06:25.94389+08:00","close_reason":"Closed","external_ref":"gh-334","labels":["jit","sandbox","wasi"]}
{"id":"wasmoon-246","title":"Regalloc: swap-aware jump-arg coalescing","description":"Prefer non-swap assignments for jump-arg parallel moves to avoid temp regs in loops (e.g. fib).","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T10:54:21.812095+08:00","created_by":"Milky2018","updated_at":"2026-01-21T11:16:46.031902+08:00","closed_at":"2026-01-21T11:16:46.031902+08:00","close_reason":"swap-aware jump-arg coalescing implemented","comments":[{"id":1,"issue_id":"wasmoon-246","author":"Milky2018","text":"Implemented swap-aware jump-arg 2-cycle break in regalloc apply_allocation (scratch redirect for locally-defined jump args). Tests: moon test.","created_at":"2026-01-21T03:16:35Z"}]}
{"id":"wasmoon-4e4","title":"Investigate JIT segfault in align.wast (moon test hang)","description":"JIT run of spec/align.wast segfaults (EXC_BAD_ACCESS in munmap). moon test hangs due to testsuite/wast_hang_regression_test.","status":"open","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T14:57:04.537589+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:57:04.537589+08:00","comments":[{"id":4,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Added WASMOON_JIT_DEBUG logging in exec_mem.c, jit_context.c, wasm_stack.c, jit.c (stack_switch + trap details). Rebuilt and reran Running WAST script: spec/align.wast\nJIT: enabled\n==================================================\n\nResults:\n  Passed:  140\n  Failed:  0\n  Skipped: 0\n================================================== with timeout; now passes 140/140 (no trap). Created  and  repro; isolated i64_align_switch passes in minimal script.  log shows mem0_base=0x9c00160000 len=65536 and stack range base/top sane. No trap log observed in recent runs.","created_at":"2026-01-21T08:12:15Z"},{"id":5,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Added WASMOON_JIT_DEBUG logging in exec_mem.c, jit_context.c, wasm_stack.c, jit.c (stack_switch + trap details). Rebuilt and reran ./wasmoon test spec/align.wast with timeout; now passes 140/140 (no trap). Created tmp_align_module.wat and tmp_align_min.wast repro; isolated i64_align_switch passes in minimal script. jit stack_switch log shows mem0_base=0x9c00160000 len=65536 and stack range base/top sane. No trap log observed in recent runs.","created_at":"2026-01-21T08:12:35Z"},{"id":6,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"User requested repro: will rerun testsuite with WASMOON_JIT_DEBUG=1 and 10s timeout to capture the SIGSEGV source.","created_at":"2026-01-21T08:16:10Z"},{"id":7,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Ran per-file tests with timeout 10: align_test.mbt passed; backtrace_test.mbt fails 10 cases. Diffs show frames collapsed to 1 and debug reports frame_lr=0 (expected nonzero). Loop stopped at first failure, so remaining files not yet checked. Likely regression in trap frame capture / FP chain with wasm stack switching.","created_at":"2026-01-21T08:18:26Z"},{"id":8,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Repro: `WASMOON_JIT_DEBUG=1 timeout 10 moon test -p testsuite -f backtrace_test.mbt` fails 10/10. Logs show stack_switch used, mem0 null (no memory). No jit trap log printed (traps are reachable/unreachable via BRK). Diffs show frame_lr=0 and frames collapsed to 1 in all cases.","created_at":"2026-01-21T08:20:07Z"},{"id":9,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Fix attempt: set g_trap_wasm_stack_base/top in jit.c before calls and clear on exit; trap handlers now preserve existing bounds when ctx is null. After rebuild, `WASMOON_JIT_DEBUG=1 timeout 10 moon test -p testsuite -f backtrace_test.mbt` passes 10/10.","created_at":"2026-01-21T08:35:42Z"},{"id":10,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"After trap-bound fix, full `timeout 10 moon test` still SIGSEGV in testsuite.blackbox_test.rspfile. backtrace_test passes, but overall testsuite still crashes; need to locate which file triggers segv.","created_at":"2026-01-21T08:37:12Z"},{"id":11,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Isolated crash to testsuite/exceptions_test.mbt index 4 (exception_catch_all). Lldb showed SIGSEGV in free_context_internal at handler-\u003eprev; WASMOON_JIT_DEBUG log showed exception_handler=0x1 before free. Added debug logging in jit/jit_ffi/exception.c for try_begin/try_end (guarded by WASMOON_JIT_DEBUG) and rebuilt; now try_begin/end pairs pop correctly and exception_handler is 0. Re-ran exceptions_test.mbt (all 17 cases) with WASMOON_JIT_DEBUG=1: pass, no segv. Looping index 4 test 10x also passes.","created_at":"2026-01-21T09:07:45Z"}]}
{"id":"wasmoon-5dg","title":"WASI proc_exit terminates host process","description":"wasi_proc_exit_impl calls exit(), killing the host. Should raise a WASI exit/trap so the caller can handle like interpreter.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:47:57.725184+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:41:14.902573+08:00","closed_at":"2026-01-21T14:41:14.902573+08:00","close_reason":"Closed","external_ref":"gh-338","labels":["jit","wasi"]}
{"id":"wasmoon-5ez","title":"Call arg consts: avoid redundant fixed-reg move bounce","description":"Remove def-fixed loads for register const args so regalloc doesn't emit back-and-forth moves before calls.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T10:27:46.240373+08:00","created_by":"Milky2018","updated_at":"2026-01-21T10:28:28.538226+08:00","closed_at":"2026-01-21T10:28:28.538227+08:00"}
{"id":"wasmoon-5kl","title":"Direct-call lowering for known Wasm calls (avoid func_table indirection)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:53:48.650054+08:00","updated_at":"2026-01-20T19:23:28.65972+08:00","closed_at":"2026-01-20T19:23:28.65972+08:00","close_reason":"Closed"}
{"id":"wasmoon-6sw","title":"Fuse cmp+branch even when cmp is not last","description":"Improve vcode fuse_cmp_branch to find cmp defs earlier in block so redundant compares and const loads are removed.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T10:35:41.132357+08:00","created_by":"Milky2018","updated_at":"2026-01-21T10:35:56.80781+08:00","closed_at":"2026-01-21T10:35:56.807812+08:00"}
{"id":"wasmoon-8z6","title":"Fix remaining JIT WAST regressions after call optimizations","description":"Investigate and fix 14 failing WAST files in JIT mode after recent call const remat and regalloc constraint fixes.","notes":"JIT WAST suite now passes 258/258 (python3 scripts/run_all_wast.py --dir spec --rec --only-jit).","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-20T20:57:53.334242+08:00","created_by":"Milky2018","updated_at":"2026-01-21T13:21:10.487917+08:00","closed_at":"2026-01-21T13:21:10.487919+08:00"}
{"id":"wasmoon-8zd","title":"Direct-call Branch26 fixups for intra-module calls","description":"Replace LoadFuncAddr+blr with bl + Branch26 fixups and patch at JIT load time.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T19:33:13.262464+08:00","created_by":"Milky2018","updated_at":"2026-01-20T19:44:34.876323+08:00","closed_at":"2026-01-20T19:44:34.876323+08:00","close_reason":"Closed","labels":["jit","perf"]}
{"id":"wasmoon-9a1","title":"Import calls via vmctx load","description":"Use vmctx func table pointer loads (LDR + BLR) for imports instead of LoadFuncAddr.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T19:33:21.047034+08:00","created_by":"Milky2018","updated_at":"2026-01-20T19:50:04.522286+08:00","closed_at":"2026-01-20T19:50:04.522286+08:00","close_reason":"Closed","labels":["jit","perf"]}
{"id":"wasmoon-a05","title":"Fuse cmp+branch to drop compare constants","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:15:13.44239+08:00","updated_at":"2026-01-20T18:21:28.5596+08:00","closed_at":"2026-01-20T18:21:28.5596+08:00","close_reason":"Closed"}
{"id":"wasmoon-e0e","title":"Fix memory64 JIT regressions after peephole","description":"Investigate peephole optimization removing needed add/move in vcode; memory64 endianness/grow/redundancy failing under JIT at -O2.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T21:50:22.46822+08:00","created_by":"Milky2018","updated_at":"2026-01-21T10:00:22.746743+08:00","closed_at":"2026-01-21T10:00:22.746745+08:00"}
{"id":"wasmoon-gai","title":"Regalloc coalescing hints for block params (edge-based)","description":"Align bundle merging with Cranelift: process Jump edges directly for block-param/arg coalescing, avoiding pre-regalloc phi rewriting.","notes":"Use Jump-edge walk to coalesce block params/args during bundle merging. Tests: moon test -p Milky2018/wasmoon/vcode/regalloc -f regalloc_wbtest.mbt.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T13:14:20.220707+08:00","created_by":"Milky2018","updated_at":"2026-01-21T13:15:19.217811+08:00","closed_at":"2026-01-21T13:15:19.217813+08:00"}
{"id":"wasmoon-m3g","title":"Compare wasmtime explore vs wasmoon benchmark.wat and decide next optimizations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:51:57.767112+08:00","updated_at":"2026-01-20T19:23:34.08186+08:00","closed_at":"2026-01-20T19:23:34.08186+08:00","close_reason":"Closed"}
{"id":"wasmoon-nyp","title":"Fix JIT regressions from const-arg remat","description":"Investigate and fix JIT regressions after const-arg rematerialization; 16 wast failures incl call/imports/gc/br_on_null. Reduce to minimal repro and adjust lowering or remove optimization.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T20:35:12.939224+08:00","created_by":"Milky2018","updated_at":"2026-01-20T20:49:25.446363+08:00","closed_at":"2026-01-20T20:49:25.446363+08:00","close_reason":"Closed","labels":["jit","regression","task"]}
{"id":"wasmoon-odp","title":"WASI JIT lacks guest-memory bounds checks","description":"Many WASI trampolines dereference guest pointers directly (ctx-\u003ememory0-\u003ebase + ptr) without bounds checks. This can SIGBUS/SIGSEGV the host. Add bounds validation against memory size and return proper WASI errors/traps.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:47:24.266879+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:23:14.954505+08:00","closed_at":"2026-01-21T14:23:14.954505+08:00","close_reason":"Closed","external_ref":"gh-335","labels":["jit","safety","wasi"]}
{"id":"wasmoon-qk3","title":"WASI quiet mode leaks /dev/null fds","description":"init_wasi_fds_quiet opens /dev/null for stdout/stderr but free_wasi_fds never closes fds 1/2, leaking descriptors. Track and close devnull fds on teardown.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:48:20.738033+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:25:49.802622+08:00","closed_at":"2026-01-21T14:25:49.802622+08:00","close_reason":"Closed","external_ref":"gh-340","labels":["jit","leak","wasi"]}
{"id":"wasmoon-s05","title":"Peephole correctness: terminator uses + store forwarding alias","description":"Harden vcode peephole: count terminator uses in in-place update optimization and conservatively clear load-store forwarding map on StorePtrNarrow to avoid overlapping store alias.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T10:16:33.893347+08:00","created_by":"Milky2018","updated_at":"2026-01-21T10:18:11.006996+08:00","closed_at":"2026-01-21T10:18:11.006998+08:00"}
{"id":"wasmoon-ufo","title":"Implement Cranelift-style constant block param elimination","description":"Add IR-level constant-phi removal based on Cranelift remove_constant_phis, with tests and pipeline integration.","notes":"Implemented IR constant block param elimination and added test. Tests: moon test -p Milky2018/wasmoon/ir -f ir_wbtest.mbt.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T13:06:19.445304+08:00","created_by":"Milky2018","updated_at":"2026-01-21T13:07:16.984493+08:00","closed_at":"2026-01-21T13:07:16.984495+08:00"}
{"id":"wasmoon-viq","title":"WASI random_get uses rand()","description":"wasi_random_get_impl uses rand() which is not cryptographically secure and often unseeded. Implement with getrandom/arc4random_buf or /dev/urandom fallback to meet WASI requirements.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:47:47.240139+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:28:30.285554+08:00","closed_at":"2026-01-21T14:28:30.285554+08:00","close_reason":"Closed","external_ref":"gh-337","labels":["jit","security","wasi"]}
{"id":"wasmoon-vqs","title":"WASI fd_prestat_dir_name should error on short buffer","description":"wasi_fd_prestat_dir_name_impl truncates guest_path silently when path_len is too small. Spec expects an error (e.g., ENAMETOOLONG/ENOBUFS) and should match interpreter behavior.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:47:35.308846+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:07:46.006252+08:00","closed_at":"2026-01-21T14:07:46.006252+08:00","close_reason":"Closed","external_ref":"gh-336","labels":["jit","wasi"]}
{"id":"wasmoon-w80","title":"WASI poll_oneoff ignores non-clock subscriptions","description":"wasi_poll_oneoff_impl only handles clock events and ignores fd read/write subscriptions. Should implement or return proper errors so callers don't hang or get incorrect results.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:48:10.197723+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:31:23.631072+08:00","closed_at":"2026-01-21T14:31:23.631072+08:00","close_reason":"Closed","external_ref":"gh-339","labels":["jit","wasi"]}
{"id":"wasmoon-wg0","title":"Regalloc: phi-move coalescing pass","description":"Add a coalescing pass for jump args -\u003e block params to eliminate redundant moves when safe across CFG.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T10:54:42.908607+08:00","created_by":"Milky2018","updated_at":"2026-01-21T11:29:16.927092+08:00","closed_at":"2026-01-21T11:29:16.927092+08:00","close_reason":"phi-move coalescing implemented","comments":[{"id":2,"issue_id":"wasmoon-wg0","author":"Milky2018","text":"Added single-predecessor block param coalescing in vcode peephole, guarded to skip func_table/exception users. Updated snapshots; tests: moon test.","created_at":"2026-01-21T03:29:03Z"}]}
