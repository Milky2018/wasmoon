{"id":"wasmoon-081","title":"JIT WASI stdin callback not supported (only static buffer)","description":"Interpreter invokes WasiContext.stdin_callback on each fd_read; JIT only supports a fixed stdin buffer via init_wasi_with_stdio and cannot call user callbacks, so repeated reads can't fetch new data.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T20:30:31.547688+08:00","created_by":"Milky2018","updated_at":"2026-01-22T08:56:33.350124+08:00","closed_at":"2026-01-22T08:56:33.350124+08:00","close_reason":"Closed","comments":[{"id":20,"issue_id":"wasmoon-081","author":"Milky2018","text":"Implemented JIT stdin callback support (C + MBT) and added a regression test; moon test -p testsuite -f wasi_jit_wbtest.mbt passed.","created_at":"2026-01-22T00:56:21Z"}]}
{"id":"wasmoon-1cg","title":"Reduce call arg moves","description":"Reduce call-argument move traffic in lowering/peephole to shrink call sequences.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T19:33:28.706462+08:00","created_by":"Milky2018","updated_at":"2026-01-20T20:32:34.837844+08:00","closed_at":"2026-01-20T20:32:34.837844+08:00","close_reason":"Closed","labels":["jit","perf"]}
{"id":"wasmoon-1en","title":"JIT WASI stdio fd semantics diverge from interpreter","description":"JIT allows fd_write on fd=0 and fd_read on fd=1/2 via native fds; interpreter only allows stdout/stderr writes and stdin reads. JIT also returns ESUCCESS on fd_close for fd\u003c3 while interpreter returns EBADF.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T20:29:16.329065+08:00","created_by":"Milky2018","updated_at":"2026-01-21T20:59:01.919125+08:00","closed_at":"2026-01-21T20:59:01.919126+08:00","comments":[{"id":15,"issue_id":"wasmoon-1en","author":"Milky2018","text":"Fixed JIT stdio semantics: fd_write/read/close/readdir reject stdio misuse; added JIT vs interp regression test.","created_at":"2026-01-21T12:58:49Z"}]}
{"id":"wasmoon-1h7","title":"JIT hang regressions in spec WASTs","description":"JIT hangs on spec/align.wast, spec/block.wast, spec/br_on_non_null.wast after recent optimizations. Reproduce in testsuite and prevent regressions via moon test.","notes":"Removed unsafe VCode coalesce pass causing JIT hangs; added JIT WAST regression tests; tightened swap-aware regalloc rewrite. Tests: moon test -p Milky2018/wasmoon/testsuite -f wast_hang_regression_test.mbt; moon test -p Milky2018/wasmoon/vcode/lower -f lower_wbtest.mbt; moon test -p Milky2018/wasmoon/vcode/regalloc -f regalloc_wbtest.mbt.","status":"closed","priority":0,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T11:36:42.659409+08:00","created_by":"Milky2018","updated_at":"2026-01-21T12:41:16.179485+08:00","closed_at":"2026-01-21T12:41:16.179487+08:00","comments":[{"id":3,"issue_id":"wasmoon-1h7","author":"Milky2018","text":"Added testsuite regression coverage in testsuite/wast_hang_regression_test.mbt to run spec/align.wast, spec/block.wast, spec/br_on_non_null.wast under JIT via WAST runner.","created_at":"2026-01-21T03:49:33Z"}]}
{"id":"wasmoon-1vb","title":"Eliminate trivial post-regalloc moves","description":"Remove redundant Move instructions when src/dst are same physical register (including float/vector aliasing), after allocation.","notes":"Added post-regalloc pass to drop redundant Move instructions with same physical reg (float/vector alias aware). Tests: moon test -p Milky2018/wasmoon/vcode/regalloc -f regalloc_wbtest.mbt.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T13:18:50.538336+08:00","created_by":"Milky2018","updated_at":"2026-01-21T13:19:47.624511+08:00","closed_at":"2026-01-21T13:19:47.624513+08:00"}
{"id":"wasmoon-1xg","title":"WASI JIT resolve_path allows path traversal outside preopens","description":"resolve_path() in jit/jit_ffi/wasi.c concatenates host preopen + guest path without canonicalization or absolute-path rejection. This allows '..' traversal to escape sandbox. Fix by rejecting absolute paths and normalizing (or using openat-based resolution) consistent with interpreter semantics.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:47:12.457222+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:06:25.94389+08:00","closed_at":"2026-01-21T14:06:25.94389+08:00","close_reason":"Closed","external_ref":"gh-334","labels":["jit","sandbox","wasi"]}
{"id":"wasmoon-246","title":"Regalloc: swap-aware jump-arg coalescing","description":"Prefer non-swap assignments for jump-arg parallel moves to avoid temp regs in loops (e.g. fib).","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T10:54:21.812095+08:00","created_by":"Milky2018","updated_at":"2026-01-21T11:16:46.031902+08:00","closed_at":"2026-01-21T11:16:46.031902+08:00","close_reason":"swap-aware jump-arg coalescing implemented","comments":[{"id":1,"issue_id":"wasmoon-246","author":"Milky2018","text":"Implemented swap-aware jump-arg 2-cycle break in regalloc apply_allocation (scratch redirect for locally-defined jump args). Tests: moon test.","created_at":"2026-01-21T03:16:35Z"}]}
{"id":"wasmoon-4e4","title":"Investigate JIT segfault in align.wast (moon test hang)","description":"JIT run of spec/align.wast segfaults (EXC_BAD_ACCESS in munmap). moon test hangs due to testsuite/wast_hang_regression_test.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T14:57:04.537589+08:00","created_by":"Milky2018","updated_at":"2026-01-22T09:06:55.812703+08:00","closed_at":"2026-01-22T09:06:55.812703+08:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Added WASMOON_JIT_DEBUG logging in exec_mem.c, jit_context.c, wasm_stack.c, jit.c (stack_switch + trap details). Rebuilt and reran Running WAST script: spec/align.wast\nJIT: enabled\n==================================================\n\nResults:\n  Passed:  140\n  Failed:  0\n  Skipped: 0\n================================================== with timeout; now passes 140/140 (no trap). Created  and  repro; isolated i64_align_switch passes in minimal script.  log shows mem0_base=0x9c00160000 len=65536 and stack range base/top sane. No trap log observed in recent runs.","created_at":"2026-01-21T08:12:15Z"},{"id":5,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Added WASMOON_JIT_DEBUG logging in exec_mem.c, jit_context.c, wasm_stack.c, jit.c (stack_switch + trap details). Rebuilt and reran ./wasmoon test spec/align.wast with timeout; now passes 140/140 (no trap). Created tmp_align_module.wat and tmp_align_min.wast repro; isolated i64_align_switch passes in minimal script. jit stack_switch log shows mem0_base=0x9c00160000 len=65536 and stack range base/top sane. No trap log observed in recent runs.","created_at":"2026-01-21T08:12:35Z"},{"id":6,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"User requested repro: will rerun testsuite with WASMOON_JIT_DEBUG=1 and 10s timeout to capture the SIGSEGV source.","created_at":"2026-01-21T08:16:10Z"},{"id":7,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Ran per-file tests with timeout 10: align_test.mbt passed; backtrace_test.mbt fails 10 cases. Diffs show frames collapsed to 1 and debug reports frame_lr=0 (expected nonzero). Loop stopped at first failure, so remaining files not yet checked. Likely regression in trap frame capture / FP chain with wasm stack switching.","created_at":"2026-01-21T08:18:26Z"},{"id":8,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Repro: `WASMOON_JIT_DEBUG=1 timeout 10 moon test -p testsuite -f backtrace_test.mbt` fails 10/10. Logs show stack_switch used, mem0 null (no memory). No jit trap log printed (traps are reachable/unreachable via BRK). Diffs show frame_lr=0 and frames collapsed to 1 in all cases.","created_at":"2026-01-21T08:20:07Z"},{"id":9,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Fix attempt: set g_trap_wasm_stack_base/top in jit.c before calls and clear on exit; trap handlers now preserve existing bounds when ctx is null. After rebuild, `WASMOON_JIT_DEBUG=1 timeout 10 moon test -p testsuite -f backtrace_test.mbt` passes 10/10.","created_at":"2026-01-21T08:35:42Z"},{"id":10,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"After trap-bound fix, full `timeout 10 moon test` still SIGSEGV in testsuite.blackbox_test.rspfile. backtrace_test passes, but overall testsuite still crashes; need to locate which file triggers segv.","created_at":"2026-01-21T08:37:12Z"},{"id":11,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Isolated crash to testsuite/exceptions_test.mbt index 4 (exception_catch_all). Lldb showed SIGSEGV in free_context_internal at handler-\u003eprev; WASMOON_JIT_DEBUG log showed exception_handler=0x1 before free. Added debug logging in jit/jit_ffi/exception.c for try_begin/try_end (guarded by WASMOON_JIT_DEBUG) and rebuilt; now try_begin/end pairs pop correctly and exception_handler is 0. Re-ran exceptions_test.mbt (all 17 cases) with WASMOON_JIT_DEBUG=1: pass, no segv. Looping index 4 test 10x also passes.","created_at":"2026-01-21T09:07:45Z"},{"id":12,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Opened PR https://github.com/Milky2018/wasmoon/pull/341 for the JIT trap stack-bounds + exec memory fix.","created_at":"2026-01-21T09:32:24Z"},{"id":21,"issue_id":"wasmoon-4e4","author":"Milky2018","text":"Repro attempts on fix/jit-wasi-parity: timeout 10 ./wasmoon test spec/align.wast passes 140/140; timeout 10 moon test -p testsuite -f wast_hang_regression_test.mbt passes 3/3; backtrace_test.mbt 10/10 and exceptions_test.mbt 17/17 also pass. No hang/segv observed.","created_at":"2026-01-22T01:06:39Z"}]}
{"id":"wasmoon-4nj","title":"Component model: plan doc","description":"Create initial component-model plan/design document under docs/.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T14:37:24.778132+08:00","created_by":"Milky2018","updated_at":"2026-01-22T14:37:35.974952+08:00","closed_at":"2026-01-22T14:37:35.974952+08:00","close_reason":"Closed"}
{"id":"wasmoon-4ua","title":"JIT hangs on myspec/wasip1/poll.wast","description":"Running ./wasmoon test myspec/wasip1/poll.wast hangs (JIT default). Repro with timeout 10s; compare --no-jit behavior; fix JIT WASI poll_oneoff behavior to match interpreter.","status":"closed","priority":1,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-22T12:16:33.439386+08:00","created_by":"Milky2018","updated_at":"2026-01-22T12:56:42.369254+08:00","closed_at":"2026-01-22T12:56:42.369254+08:00","close_reason":"fixed","comments":[{"id":27,"issue_id":"wasmoon-4ua","author":"Milky2018","text":"Repro attempt: timeout 10s ./wasmoon test myspec/wasip1/poll.wast passes (10/10) after updating ./wasmoon from target/native/release/build/cli/main/main.exe; unable to reproduce hang. Likely stale ./wasmoon binary—please confirm.","created_at":"2026-01-22T04:18:24Z"},{"id":28,"issue_id":"wasmoon-4ua","author":"Milky2018","text":"Root cause likely poll_oneoff blocks on stdio fds; interpreter ignores fd 0-2 (virtual stdio), so JIT should skip polling them. Implemented skip in jit/jit_ffi/wasi.c. Local moon build currently fails due to x86_64 objects in _build vs arm64 libmoonbitrun.o; need environment/toolchain fix to rebuild and validate.","created_at":"2026-01-22T04:37:22Z"},{"id":29,"issue_id":"wasmoon-4ua","author":"Milky2018","text":"Fix: JIT poll_oneoff now skips stdio fds (0-2) to match interpreter, avoiding stdin poll hang; added testsuite coverage for poll_oneoff stdin. Repro now passes: timeout 10s ./wasmoon test myspec/wasip1/poll.wast --debug; moon test -p testsuite -f wasi_jit_wbtest.mbt.","created_at":"2026-01-22T04:56:02Z"}]}
{"id":"wasmoon-5cl","title":"JIT WASI: handle surrogate pairs in string_to_cstring for args/env/preopens","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T13:22:41.017251+08:00","updated_at":"2026-01-22T13:34:59.766009+08:00","closed_at":"2026-01-22T13:34:59.766009+08:00","close_reason":"implemented surrogate pair handling in JIT string_to_cstring"}
{"id":"wasmoon-5dg","title":"WASI proc_exit terminates host process","description":"wasi_proc_exit_impl calls exit(), killing the host. Should raise a WASI exit/trap so the caller can handle like interpreter.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:47:57.725184+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:41:14.902573+08:00","closed_at":"2026-01-21T14:41:14.902573+08:00","close_reason":"Closed","external_ref":"gh-338","labels":["jit","wasi"]}
{"id":"wasmoon-5ez","title":"Call arg consts: avoid redundant fixed-reg move bounce","description":"Remove def-fixed loads for register const args so regalloc doesn't emit back-and-forth moves before calls.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T10:27:46.240373+08:00","created_by":"Milky2018","updated_at":"2026-01-21T10:28:28.538226+08:00","closed_at":"2026-01-21T10:28:28.538227+08:00"}
{"id":"wasmoon-5g6","title":"Review WASIp1 JIT implementation for potential issues","notes":"Reviewed JIT WASI implementation; follow-ups: wasmoon-5cl (UTF-8 surrogate pairs), wasmoon-ngr (int32 pointer args for \u003e=2GB), wasmoon-97p (fd_seek EINVAL), wasmoon-9ho (poll_oneoff clock events)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T13:04:54.891587+08:00","updated_at":"2026-01-22T13:23:53.905174+08:00","closed_at":"2026-01-22T13:23:53.905174+08:00","close_reason":"review completed"}
{"id":"wasmoon-5kl","title":"Direct-call lowering for known Wasm calls (avoid func_table indirection)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:53:48.650054+08:00","updated_at":"2026-01-20T19:23:28.65972+08:00","closed_at":"2026-01-20T19:23:28.65972+08:00","close_reason":"Closed"}
{"id":"wasmoon-64x","title":"JIT WASI fd_renumber requires target fd to exist","description":"wasi_fd_renumber_impl uses get_native_fd(to_fd) and fails if to_fd is unused; interpreter uses dup2 to renumber to any fd \u003e=3. JIT should allow renumbering to unused slots and update fd_table accordingly.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T20:30:18.361721+08:00","created_by":"Milky2018","updated_at":"2026-01-21T21:48:41.464058+08:00","closed_at":"2026-01-21T21:48:41.464059+08:00","comments":[{"id":19,"issue_id":"wasmoon-64x","author":"Milky2018","text":"Allow fd_renumber to target unused fds by expanding fd tables and moving metadata; added regression test for renumber to unused target.","created_at":"2026-01-21T13:48:22Z"}]}
{"id":"wasmoon-6az","title":"JIT WASI path_* uses 4096 path cap and ignores path_link flags","description":"Several JIT path_* ops copy into fixed 4096-byte buffers and return EINVAL for longer paths (path_filestat_get/readlink/link/symlink/etc), while interpreter reads full len. JIT path_link also ignores old_flags (AT_SYMLINK_FOLLOW).","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T20:29:59.818485+08:00","created_by":"Milky2018","updated_at":"2026-01-21T21:42:25.128807+08:00","closed_at":"2026-01-21T21:42:25.128808+08:00","comments":[{"id":18,"issue_id":"wasmoon-6az","author":"Milky2018","text":"Removed fixed 4096-byte path buffers in path_* ops, switched to dynamic allocations, and implemented path_link old_flags via linkat. Added path_open-with-opened-dir and path_link regression tests.","created_at":"2026-01-21T13:42:11Z"}]}
{"id":"wasmoon-6pd","title":"Commit updated .mbti files","description":"Track commit of updated generated .mbti files after recent WASI JIT fixes.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T14:16:17.164412+08:00","created_by":"Milky2018","updated_at":"2026-01-22T14:17:21.494167+08:00","closed_at":"2026-01-22T14:17:21.494167+08:00","close_reason":"Committed updated .mbti files."}
{"id":"wasmoon-6sw","title":"Fuse cmp+branch even when cmp is not last","description":"Improve vcode fuse_cmp_branch to find cmp defs earlier in block so redundant compares and const loads are removed.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T10:35:41.132357+08:00","created_by":"Milky2018","updated_at":"2026-01-21T10:35:56.80781+08:00","closed_at":"2026-01-21T10:35:56.807812+08:00"}
{"id":"wasmoon-6u4","title":"Component model: parsing + IR","description":"Add component AST, binary/text parsers for component sections, and minimal WIT type mapping to support canonical ABI.","status":"in_progress","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T14:36:33.181736+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:10:32.472014+08:00","dependencies":[{"issue_id":"wasmoon-6u4","depends_on_id":"wasmoon-j78","type":"blocks","created_at":"2026-01-22T15:19:42.145718+08:00","created_by":"Milky2018"},{"issue_id":"wasmoon-6u4","depends_on_id":"wasmoon-zut","type":"blocks","created_at":"2026-01-22T15:27:44.690423+08:00","created_by":"Milky2018"}],"comments":[{"id":30,"issue_id":"wasmoon-6u4","author":"Milky2018","text":"Initial scaffolding: add new package Milky2018/wasmoon/component with wasm header sniffing (core vs component), update CLI loader to detect component binaries and return a clear not-supported error, and add testsuite coverage (component_header_test). Tests: moon check; moon test -p testsuite -f component_header_test.mbt.","created_at":"2026-01-22T07:16:13Z"}]}
{"id":"wasmoon-8j5","title":"JIT crashes on core spec WAST (SIGSEGV)","description":"run_all_wast.py --dir spec --rec --only-jit shows 59 crashes; ./wasmoon test spec/i32.wast exits 139","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T19:31:49.805524+08:00","created_by":"Milky2018","updated_at":"2026-01-21T19:49:33.239958+08:00","closed_at":"2026-01-21T19:49:33.239958+08:00","close_reason":"Closed","comments":[{"id":14,"issue_id":"wasmoon-8j5","author":"Milky2018","text":"Root cause: JIT context free crashed because fd/preopen fields were uninitialized when init_wasi wasn't called; wasmoon_jit_free_wasi_fds attempted to free garbage pointers. Fix: initialize fd_table/preopen fields to NULL/0 in alloc_context_internal. Verified ./wasmoon test spec/i32.wast passes; run_all_wast.py --dir spec --rec --only-jit now 258/258 pass.","created_at":"2026-01-21T11:49:22Z"}]}
{"id":"wasmoon-8z6","title":"Fix remaining JIT WAST regressions after call optimizations","description":"Investigate and fix 14 failing WAST files in JIT mode after recent call const remat and regalloc constraint fixes.","notes":"JIT WAST suite now passes 258/258 (python3 scripts/run_all_wast.py --dir spec --rec --only-jit).","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-20T20:57:53.334242+08:00","created_by":"Milky2018","updated_at":"2026-01-21T13:21:10.487917+08:00","closed_at":"2026-01-21T13:21:10.487919+08:00"}
{"id":"wasmoon-8zd","title":"Direct-call Branch26 fixups for intra-module calls","description":"Replace LoadFuncAddr+blr with bl + Branch26 fixups and patch at JIT load time.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T19:33:13.262464+08:00","created_by":"Milky2018","updated_at":"2026-01-20T19:44:34.876323+08:00","closed_at":"2026-01-20T19:44:34.876323+08:00","close_reason":"Closed","labels":["jit","perf"]}
{"id":"wasmoon-944","title":"JIT fd_seek/fd_tell on stdio returns success in WAST quiet mode","description":"WAST myspec/wasip1/fd.wast expects ESPIPE for stdout, but JIT quiet mode maps stdio to /dev/null and fd_seek/fd_tell returns success.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-22T09:11:29.893169+08:00","created_by":"Milky2018","updated_at":"2026-01-22T09:11:57.305852+08:00","closed_at":"2026-01-22T09:11:57.305852+08:00","close_reason":"Closed","comments":[{"id":22,"issue_id":"wasmoon-944","author":"Milky2018","text":"Fixed wasi_fd_seek_impl to return ESPIPE for wasi fd \u003c 3 regardless of native fd, aligning with interpreter; myspec/wasip1/fd.wast now passes (46/46).","created_at":"2026-01-22T01:11:43Z"}]}
{"id":"wasmoon-97p","title":"JIT WASI: fd_seek invalid whence should return EINVAL","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T13:23:09.491623+08:00","updated_at":"2026-01-22T13:55:28.161231+08:00","closed_at":"2026-01-22T13:55:28.161231+08:00","close_reason":"validate whence and map lseek errno to WASI"}
{"id":"wasmoon-9a1","title":"Import calls via vmctx load","description":"Use vmctx func table pointer loads (LDR + BLR) for imports instead of LoadFuncAddr.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T19:33:21.047034+08:00","created_by":"Milky2018","updated_at":"2026-01-20T19:50:04.522286+08:00","closed_at":"2026-01-20T19:50:04.522286+08:00","close_reason":"Closed","labels":["jit","perf"]}
{"id":"wasmoon-9ho","title":"WASI poll_oneoff: avoid emitting clock events before timeout fires","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T13:23:19.831684+08:00","updated_at":"2026-01-22T14:01:54.786781+08:00","closed_at":"2026-01-22T14:01:54.786781+08:00","close_reason":"emit clock events only on timeout in poll_oneoff"}
{"id":"wasmoon-a05","title":"Fuse cmp+branch to drop compare constants","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:15:13.44239+08:00","updated_at":"2026-01-20T18:21:28.5596+08:00","closed_at":"2026-01-20T18:21:28.5596+08:00","close_reason":"Closed"}
{"id":"wasmoon-cd9","title":"Fix JIT vmctx passing for wasm-\u003ewasm calls (WASI crash)","description":"JIT crashes with SIGSEGV on wasip1 args_get.wasm; vmctx in X0 becomes 0x2 when calling wasm function directly. Ensure vmctx (x21) is reloaded into x0 for every wasm-\u003ewasm call.","status":"closed","priority":1,"issue_type":"bug","assignee":"Milky2018","owner":"842376130@qq.com","created_at":"2026-01-22T10:06:54.118093+08:00","created_by":"Milky2018","updated_at":"2026-01-22T12:10:32.490474+08:00","closed_at":"2026-01-22T12:10:32.490474+08:00","close_reason":"Closed","comments":[{"id":24,"issue_id":"wasmoon-cd9","author":"Milky2018","text":"Tried vmctx refresh around Wasm calls (LoweringContext vmctx_value + Move into x21 before/after calls). args_get.wasm no longer crashes in func_2, but still traps with OOB in func_3 (SIGBUS) when running: target/native/release/build/cli/main/main.exe run ... --wasi common. Latest trap: func_3+0xb0 store_ptr to addr ~0x0000000500210004, caller func_4.","created_at":"2026-01-22T03:52:18Z"},{"id":25,"issue_id":"wasmoon-cd9","author":"Milky2018","text":"Root cause: reload-coalescing picked x21 as a reload register, clobbering pinned VMCTX (stack_load into x21 after wasm calls). Fix: reserve REG_VMCTX in reload allocator and drop x21 from reload candidates. Repro args_get.wasm now runs clean under JIT.","created_at":"2026-01-22T04:09:44Z"},{"id":26,"issue_id":"wasmoon-cd9","author":"Milky2018","text":"Validated: args_get.wasm runs under JIT; python3.11 scripts/run_all_wast.py --dir spec --rec --only-jit passes 258/258.","created_at":"2026-01-22T04:10:21Z"}]}
{"id":"wasmoon-d4g","title":"JIT WASI preopen fds accepted by fd_* ops that interpreter rejects","description":"Many JIT fd_* ops use get_native_fd and thus operate on preopen directory fds (e.g. fd_advise, fd_allocate, fd_sync, fd_datasync, fd_fdstat_set_flags, fd_fdstat_set_rights, fd_filestat_set_size, fd_filestat_set_times, fd_seek/tell/pread/pwrite). Interpreter only allows preopens in fd_prestat/get/dir_name, fd_readdir, fd_fdstat_get, fd_filestat_get; other ops return EBADF.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T20:29:30.794941+08:00","created_by":"Milky2018","updated_at":"2026-01-21T21:13:36.890578+08:00","closed_at":"2026-01-21T21:13:36.89058+08:00","comments":[{"id":16,"issue_id":"wasmoon-d4g","author":"Milky2018","text":"Aligned JIT preopen fd behavior with interpreter: open preopen dirs into fd_table, allow fd_* ops on them, and map native failures to EIO for parity (seek/sync/datasync/pread/pwrite/filestat_set_size/times/allocate/fdstat_set_flags). Added regression test.","created_at":"2026-01-21T13:13:25Z"}]}
{"id":"wasmoon-e0e","title":"Fix memory64 JIT regressions after peephole","description":"Investigate peephole optimization removing needed add/move in vcode; memory64 endianness/grow/redundancy failing under JIT at -O2.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T21:50:22.46822+08:00","created_by":"Milky2018","updated_at":"2026-01-21T10:00:22.746743+08:00","closed_at":"2026-01-21T10:00:22.746745+08:00"}
{"id":"wasmoon-edj","title":"Run wasip1 WASI test suite against wasmoon","description":"Use ../wasip1 test harness (deno test) with a wasmtime-\u003ewasmoon wrapper to run WASI preview1 end-to-end and compare snapshots.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T09:22:19.677253+08:00","created_by":"Milky2018","updated_at":"2026-01-22T10:51:42.10272+08:00","closed_at":"2026-01-22T10:51:42.10272+08:00","close_reason":"Completed: myspec/wasip1 JIT run is clean","comments":[{"id":23,"issue_id":"wasmoon-edj","author":"Milky2018","text":"Ran: python3.11 scripts/run_all_wast.py --dir myspec/wasip1 --rec --only-jit --dump-failures. Result: 9/9 files passed (116 tests), 0 failures/errors.","created_at":"2026-01-22T02:51:32Z"}]}
{"id":"wasmoon-gai","title":"Regalloc coalescing hints for block params (edge-based)","description":"Align bundle merging with Cranelift: process Jump edges directly for block-param/arg coalescing, avoiding pre-regalloc phi rewriting.","notes":"Use Jump-edge walk to coalesce block params/args during bundle merging. Tests: moon test -p Milky2018/wasmoon/vcode/regalloc -f regalloc_wbtest.mbt.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T13:14:20.220707+08:00","created_by":"Milky2018","updated_at":"2026-01-21T13:15:19.217811+08:00","closed_at":"2026-01-21T13:15:19.217813+08:00"}
{"id":"wasmoon-if1","title":"Component model MVP","description":"Track initial WebAssembly Component Model support: parsing/IR, validation, runtime/linker, and CLI/tests.","status":"open","priority":2,"issue_type":"epic","owner":"842376130@qq.com","created_at":"2026-01-22T15:09:20.533848+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:09:20.533848+08:00","dependencies":[{"issue_id":"wasmoon-if1","depends_on_id":"wasmoon-6u4","type":"blocks","created_at":"2026-01-22T15:09:42.287359+08:00","created_by":"Milky2018"},{"issue_id":"wasmoon-if1","depends_on_id":"wasmoon-zyb","type":"blocks","created_at":"2026-01-22T15:09:47.569919+08:00","created_by":"Milky2018"},{"issue_id":"wasmoon-if1","depends_on_id":"wasmoon-ifh","type":"blocks","created_at":"2026-01-22T15:09:52.845995+08:00","created_by":"Milky2018"},{"issue_id":"wasmoon-if1","depends_on_id":"wasmoon-tcs","type":"blocks","created_at":"2026-01-22T15:09:58.125935+08:00","created_by":"Milky2018"}]}
{"id":"wasmoon-ifh","title":"Component model: runtime + linker","description":"Build component instantiation/linking, adapter dispatch, and bridge to core Wasm runtime/executor/JIT.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T14:36:58.838999+08:00","created_by":"Milky2018","updated_at":"2026-01-22T14:36:58.838999+08:00"}
{"id":"wasmoon-j78","title":"Component model: parse component binary framing","description":"Implement minimal component binary parser (magic+version, section loop, leb sizes) to provide a base for later type/import/export parsing.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T15:19:30.680945+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:25:41.249555+08:00","closed_at":"2026-01-22T15:25:41.249557+08:00","comments":[{"id":31,"issue_id":"wasmoon-j78","author":"Milky2018","text":"Implemented minimal component binary parser: header validation (magic+version), LEB u32 decoding, and section framing loop into raw sections. Tests: moon check; moon test -p testsuite -f component_parse_test.mbt.","created_at":"2026-01-22T07:25:35Z"}]}
{"id":"wasmoon-m3g","title":"Compare wasmtime explore vs wasmoon benchmark.wat and decide next optimizations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:51:57.767112+08:00","updated_at":"2026-01-20T19:23:34.08186+08:00","closed_at":"2026-01-20T19:23:34.08186+08:00","close_reason":"Closed"}
{"id":"wasmoon-ngr","title":"JIT WASI: fix int32 pointer args to support \u003e=2GB memory offsets","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T13:22:53.891558+08:00","updated_at":"2026-01-22T13:53:41.003308+08:00","closed_at":"2026-01-22T13:53:41.003308+08:00","close_reason":"handle u32 pointers/lengths in JIT WASI memory access"}
{"id":"wasmoon-nyp","title":"Fix JIT regressions from const-arg remat","description":"Investigate and fix JIT regressions after const-arg rematerialization; 16 wast failures incl call/imports/gc/br_on_null. Reduce to minimal repro and adjust lowering or remove optimization.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-20T20:35:12.939224+08:00","created_by":"Milky2018","updated_at":"2026-01-20T20:49:25.446363+08:00","closed_at":"2026-01-20T20:49:25.446363+08:00","close_reason":"Closed","labels":["jit","regression","task"]}
{"id":"wasmoon-odp","title":"WASI JIT lacks guest-memory bounds checks","description":"Many WASI trampolines dereference guest pointers directly (ctx-\u003ememory0-\u003ebase + ptr) without bounds checks. This can SIGBUS/SIGSEGV the host. Add bounds validation against memory size and return proper WASI errors/traps.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:47:24.266879+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:23:14.954505+08:00","closed_at":"2026-01-21T14:23:14.954505+08:00","close_reason":"Closed","external_ref":"gh-335","labels":["jit","safety","wasi"]}
{"id":"wasmoon-qk3","title":"WASI quiet mode leaks /dev/null fds","description":"init_wasi_fds_quiet opens /dev/null for stdout/stderr but free_wasi_fds never closes fds 1/2, leaking descriptors. Track and close devnull fds on teardown.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:48:20.738033+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:25:49.802622+08:00","closed_at":"2026-01-21T14:25:49.802622+08:00","close_reason":"Closed","external_ref":"gh-340","labels":["jit","leak","wasi"]}
{"id":"wasmoon-s05","title":"Peephole correctness: terminator uses + store forwarding alias","description":"Harden vcode peephole: count terminator uses in in-place update optimization and conservatively clear load-store forwarding map on StorePtrNarrow to avoid overlapping store alias.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T10:16:33.893347+08:00","created_by":"Milky2018","updated_at":"2026-01-21T10:18:11.006996+08:00","closed_at":"2026-01-21T10:18:11.006998+08:00"}
{"id":"wasmoon-sem","title":"Fix WASI JIT parity issues","description":"Fix JIT WASI mismatches vs interpreter:\\n- fd_readdir only works for preopen fds (dir from path_open returns ENOTDIR)\\n- fd_prestat_dir_name missing bounds check for path_ptr\\n- path_open ignores rights_base/rights_inheriting\\n- JIT ignores WasiContextBuilder stdio callbacks\\n- JIT WASI resources not freed on context teardown","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T18:31:23.802546+08:00","created_by":"Milky2018","updated_at":"2026-01-21T19:16:22.943455+08:00","closed_at":"2026-01-21T19:16:22.943455+08:00","close_reason":"Closed","labels":["status:in_progress"],"comments":[{"id":13,"issue_id":"wasmoon-sem","author":"Milky2018","text":"Implemented JIT WASI parity fixes (fd_readdir on path_open, rights validation, stdout/stderr capture + stdin buffer, fd_prestat bounds, WASI resource cleanup). Tests: moon test -p testsuite -f wasi_jit_wbtest.mbt; moon test -p Milky2018/wasmoon/wasi -f wasi_wbtest.mbt.","created_at":"2026-01-21T11:16:07Z"}]}
{"id":"wasmoon-sem.1","title":"State change: status → in_progress","description":"Set status to in_progress","status":"closed","priority":4,"issue_type":"event","created_at":"2026-01-21T18:32:13.367997+08:00","created_by":"Milky2018","updated_at":"2026-01-21T18:32:13.367997+08:00","closed_at":"2026-01-21T18:32:14.367997+08:00","dependencies":[{"issue_id":"wasmoon-sem.1","depends_on_id":"wasmoon-sem","type":"parent-child","created_at":"2026-01-21T18:32:13.368895+08:00","created_by":"Milky2018"}]}
{"id":"wasmoon-tcs","title":"Component model: CLI + tests","description":"Add CLI subcommands/flags for components plus fixtures and spec tests for component model and canonical ABI.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T14:37:09.126166+08:00","created_by":"Milky2018","updated_at":"2026-01-22T14:37:09.126166+08:00"}
{"id":"wasmoon-ufo","title":"Implement Cranelift-style constant block param elimination","description":"Add IR-level constant-phi removal based on Cranelift remove_constant_phis, with tests and pipeline integration.","notes":"Implemented IR constant block param elimination and added test. Tests: moon test -p Milky2018/wasmoon/ir -f ir_wbtest.mbt.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T13:06:19.445304+08:00","created_by":"Milky2018","updated_at":"2026-01-21T13:07:16.984493+08:00","closed_at":"2026-01-21T13:07:16.984495+08:00"}
{"id":"wasmoon-viq","title":"WASI random_get uses rand()","description":"wasi_random_get_impl uses rand() which is not cryptographically secure and often unseeded. Implement with getrandom/arc4random_buf or /dev/urandom fallback to meet WASI requirements.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:47:47.240139+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:28:30.285554+08:00","closed_at":"2026-01-21T14:28:30.285554+08:00","close_reason":"Closed","external_ref":"gh-337","labels":["jit","security","wasi"]}
{"id":"wasmoon-vqs","title":"WASI fd_prestat_dir_name should error on short buffer","description":"wasi_fd_prestat_dir_name_impl truncates guest_path silently when path_len is too small. Spec expects an error (e.g., ENAMETOOLONG/ENOBUFS) and should match interpreter behavior.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:47:35.308846+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:07:46.006252+08:00","closed_at":"2026-01-21T14:07:46.006252+08:00","close_reason":"Closed","external_ref":"gh-336","labels":["jit","wasi"]}
{"id":"wasmoon-w80","title":"WASI poll_oneoff ignores non-clock subscriptions","description":"wasi_poll_oneoff_impl only handles clock events and ignores fd read/write subscriptions. Should implement or return proper errors so callers don't hang or get incorrect results.","status":"closed","priority":2,"issue_type":"bug","owner":"842376130@qq.com","created_at":"2026-01-21T13:48:10.197723+08:00","created_by":"Milky2018","updated_at":"2026-01-21T14:31:23.631072+08:00","closed_at":"2026-01-21T14:31:23.631072+08:00","close_reason":"Closed","external_ref":"gh-339","labels":["jit","wasi"]}
{"id":"wasmoon-wg0","title":"Regalloc: phi-move coalescing pass","description":"Add a coalescing pass for jump args -\u003e block params to eliminate redundant moves when safe across CFG.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T10:54:42.908607+08:00","created_by":"Milky2018","updated_at":"2026-01-21T11:29:16.927092+08:00","closed_at":"2026-01-21T11:29:16.927092+08:00","close_reason":"phi-move coalescing implemented","comments":[{"id":2,"issue_id":"wasmoon-wg0","author":"Milky2018","text":"Added single-predecessor block param coalescing in vcode peephole, guarded to skip func_table/exception users. Updated snapshots; tests: moon test.","created_at":"2026-01-21T03:29:03Z"}]}
{"id":"wasmoon-xg5","title":"JIT WASI path_* only resolves preopen dir_fds","description":"jit/jit_ffi/wasi.c resolve_path() only uses preopen paths; directories opened via path_open cannot be used as dir_fd for path_open/path_filestat_get/path_rename/etc, unlike interpreter WasiContext::resolve_path which supports open directory fds.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-21T20:29:46.824482+08:00","created_by":"Milky2018","updated_at":"2026-01-21T21:21:16.133643+08:00","closed_at":"2026-01-21T21:21:16.133648+08:00","comments":[{"id":17,"issue_id":"wasmoon-xg5","author":"Milky2018","text":"Added open-dir fd metadata to JIT (host path + dir flag), resolve_path now accepts non-preopen dir_fds, path_open stores metadata, and preopen dirs populate metadata. Added regression test for path ops on opened dir fd.","created_at":"2026-01-21T13:21:02Z"}]}
{"id":"wasmoon-zut","title":"Component model: parse type section","description":"Parse component type section into a typed AST (component-level types + canonicalization scaffolding). Start with framing + index spaces; keep bodies as raw until validation is added.","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T15:27:33.782937+08:00","created_by":"Milky2018","updated_at":"2026-01-22T15:40:19.436748+08:00","closed_at":"2026-01-22T15:40:19.436749+08:00","comments":[{"id":32,"issue_id":"wasmoon-zut","author":"Milky2018","text":"Implemented initial component type section parsing (section 7): primvaltype + basic func types (sync/async), plus empty component/instance types; other type opcodes return UnsupportedTypeOpcode for now. Tests: moon check; moon test -p testsuite -f component_type_section_test.mbt.","created_at":"2026-01-22T07:40:14Z"}]}
{"id":"wasmoon-zyb","title":"Component model: validation + canonical ABI","description":"Implement validator rules for component type checking, alias/import/export/instance order, and canonical ABI constraints for lift/lower.","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-22T14:36:46.759577+08:00","created_by":"Milky2018","updated_at":"2026-01-22T14:36:46.759577+08:00"}
